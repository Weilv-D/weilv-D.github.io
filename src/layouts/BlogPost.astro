---
import type { CollectionEntry } from 'astro:content';
import BaseLayout from './BaseLayout.astro';

type Props = CollectionEntry<'blog'>['data'];

const { title, description, pubDate, updatedDate, heroImage } = Astro.props;
---

<BaseLayout title={title} description={description}>
	<article class="prose dark:prose-invert prose-lg max-w-none animate-fade-in-up">
        <header class="mb-10 not-prose">
            <div class="text-sm text-[var(--color-secondary)] mb-4 flex items-center gap-2">
                <time datetime={pubDate.toISOString()}>
                    {pubDate.toLocaleDateString('en-us', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                    })}
                </time>
                {updatedDate && (
                    <span class="italic text-xs bg-[var(--color-surface)] px-2 py-0.5 rounded-full border border-[var(--color-border)]">
                        Updated
                    </span>
                )}
            </div>
            <h1 class="text-4xl md:text-6xl font-serif font-bold mb-6 leading-tight text-[var(--color-primary)]">{title}</h1>
            {heroImage && (
                <div class="relative aspect-video overflow-hidden rounded-xl shadow-lg mb-8">
                    <img src={heroImage} alt="" class="object-cover w-full h-full hover:scale-105 transition-transform duration-700" />
                </div>
            )}
            <hr class="border-[var(--color-border)]" />
        </header>
		<div class="prose-content">
            <slot />
        </div>
	</article>
</BaseLayout>

<script>
  // Copy Code Functionality
  const copyButtonLabel = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>`;
  const copiedButtonLabel = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>`;

  document.querySelectorAll('pre').forEach((pre) => {
    const button = document.createElement('button');
    button.innerHTML = copyButtonLabel;
    button.className = 'copy-code-btn';
    button.setAttribute('aria-label', 'Copy code');

    pre.appendChild(button);

    button.addEventListener('click', async () => {
      const code = pre.querySelector('code');
      const text = code?.innerText || '';

      await navigator.clipboard.writeText(text);

      button.innerHTML = copiedButtonLabel;
      button.classList.add('text-green-500');
      
      setTimeout(() => {
        button.innerHTML = copyButtonLabel;
        button.classList.remove('text-green-500');
      }, 2000);
    });
  });
</script>
