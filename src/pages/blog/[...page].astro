---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PostList from '../../components/PostList';
import { getCollection } from 'astro:content';

export async function getStaticPaths({ paginate }) {
  const posts = (await getCollection('blog')).sort(
    (a, b) => a.data.pubDate.valueOf() - b.data.pubDate.valueOf()
  );
  return paginate(posts, { pageSize: 5 });
}

const { page } = Astro.props;

// Transform Astro data to match React component props
const initialPosts = page.data.map(post => ({
    title: post.data.title,
    description: post.data.description,
    slug: post.slug,
    pubDate: post.data.pubDate.toISOString(),
    category: post.data.category,
    heroImage: post.data.heroImage,
    tags: post.data.tags
}));
---

<BaseLayout title="文章 | 未来回忆录" description="weilv的所有文章">
	<section>
		<h1 class="text-4xl font-serif font-bold mb-12">所有文章</h1>
		
        <PostList client:load initialPosts={initialPosts} />

        {/* Static Pagination Controls (Hidden when client mode is active, handled by React component logic visually) */}
        <div class="flex justify-between mt-12 pt-8 border-t border-[var(--color-border)]">
            {page.url.prev ? (
                <a href={`${import.meta.env.BASE_URL}${page.url.prev.slice(1)}`} class="text-sm font-medium link-underline">
                    &larr; 上一页
                </a>
            ) : <div></div>}
            
            <span class="text-sm text-[var(--color-secondary)]">
                第 {page.currentPage} 页 / 共 {page.lastPage} 页
            </span>

            {page.url.next ? (
                <a href={`${import.meta.env.BASE_URL}${page.url.next.slice(1)}`} class="text-sm font-medium link-underline">
                    下一页 &rarr;
                </a>
            ) : <div></div>}
        </div>
	</section>
</BaseLayout>
